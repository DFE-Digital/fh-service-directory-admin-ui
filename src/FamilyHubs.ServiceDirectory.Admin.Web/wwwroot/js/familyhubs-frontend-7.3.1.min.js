const COOKIE_CATEGORIES={analytics:["_ga","_ga_"+window.GA_CONTAINER_ID],essential:[window.GA_COOKIE_NAME]},DEFAULT_COOKIE_CONSENT={analytics:!1,version:window.GDS_CONSENT_COOKIE_VERSION};function getConsentCookie(){const e=getCookie(window.GA_COOKIE_NAME);let t;if(!e)return null;try{t=JSON.parse(e)}catch(e){return null}return t}function isValidConsentCookie(e){return e&&e.version>=window.GDS_CONSENT_COOKIE_VERSION}function setConsentCookie(e){let t=getConsentCookie();for(var o in t||(t=JSON.parse(JSON.stringify(DEFAULT_COOKIE_CONSENT))),e)t[o]=e[o];delete t.essential,t.version=window.GDS_CONSENT_COOKIE_VERSION,setCookie(window.GA_COOKIE_NAME,JSON.stringify(t),{days:365}),resetCookies()}function resetCookies(){var e=getConsentCookie();for(var t in isValidConsentCookie(e)||(e=JSON.parse(JSON.stringify(DEFAULT_COOKIE_CONSENT))),e){if("version"!==t)if("essential"!==t)if(!e[t])COOKIE_CATEGORIES[t].forEach((function(e){deleteCookie(e)}))}}function userAllowsCookieCategory(e,t){if("essential"===e)return!0;try{return t[e]}catch(e){return console.error(e),!1}}function userAllowsCookie(e){if(e===window.GA_COOKIE_NAME)return!0;var t=getConsentCookie();for(var o in isValidConsentCookie(t)||(t=DEFAULT_COOKIE_CONSENT),COOKIE_CATEGORIES){if("-1"!==COOKIE_CATEGORIES[o].indexOf(e))return userAllowsCookieCategory(o,t)}return!1}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0,i=o.length;n<i;n++){for(var r=o[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length))}return null}function setCookie(e,t,o){if(userAllowsCookie(e)){void 0===o&&(o={});var n=e+"="+t+"; path=/; SameSite=Strict";if(o.days){var i=new Date;i.setTime(i.getTime()+24*o.days*60*60*1e3),n=n+"; expires="+i.toUTCString()}"https:"===document.location.protocol&&(n+="; Secure"),document.cookie=n}}function deleteCookie(e){getCookie(e)&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain="+window.location.hostname+";path=/",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain=."+window.location.hostname+";path=/")}function nodeListForEach(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}const INCODE_REGEX=/\d[a-z]{2}$/i,POSTCODE_REGEX=/^[a-z]{1,2}\d[a-z\d]?\s*\d[a-z]{2}$/i,SPACE_REGEX=/\s+/gi,sanitize=e=>e.replace(SPACE_REGEX,"").toUpperCase(),isValid=e=>null!==e.match(POSTCODE_REGEX),toOutcode=e=>isValid(e)?sanitize(e).replace(INCODE_REGEX,""):null;function gtag(e,...t){window.dataLayer=window.dataLayer||[],window.dataLayer.push(arguments)}let GaMeasurementId="";function initAnalytics(e){if(!Boolean(e))return;GaMeasurementId=e,setDefaultConsent(),loadGaScript(e),gtag("js",new Date);const t=getPiiSafePageView(e);gtag("config",e,{send_page_view:!1,page_path:t.page_path,page_location:t.page_location,page_referrer:t.referrer,cookie_flags:"secure"});const o=getConsentCookie();o&&isValidConsentCookie(o)&&o.analytics&&updateAnalyticsStorageConsent(!0),sendPageViewEvent(),sendFilterPageCustomEvent()}function setDefaultConsent(){gtag("consent","default",{analytics_storage:"denied"}),gtag("set","url_passthrough",!0)}function updateAnalyticsStorageConsent(e,t){let o={analytics_storage:e?"granted":"denied"};void 0!==t&&(o.wait_for_update=t),gtag("consent","update",o)}function sendPageViewEvent(){gtag("event","page_view",getPiiSafePageView(GaMeasurementId))}function sendFilterPageCustomEvent(){const e=document.getElementById("results"),t=null==e?void 0:e.getAttribute("data-total-results");void 0!==t&&gtag("event","filter_page",{total_results:t})}function sendAnalyticsCustomEvent(e,t){gtag("event","analytics",{accepted:e,source:t})}function loadGaScript(e){const t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.async=!0,o.src="https://www.googletagmanager.com/gtag/js?id="+e,t.parentNode.insertBefore(o,t)}function getPiiSafePageView(e){const t={page_title:document.title,send_to:e,referrer:"",page_location:"",page_path:""};if(""!==document.referrer){const e=getPiiSafeQueryString(new URL(document.referrer).search);if(null==e)t.referrer=document.referrer;else{const o=document.referrer.split("?");t.referrer=o[0]+e}}const o=getPiiSafeQueryString(window.location.search);if(null==o)return t.page_location=window.location.href,t.page_path=window.location.pathname+window.location.search,t;const n=window.location.href.split("?");return t.page_location=n[0]+o,t.page_path=window.location.pathname+o,t}function getPiiSafeQueryString(e){const t=new URLSearchParams(e);let o=t.get("postcode");return null==o?null:(o=toOutcode(o),t.set("postcode",o),t.delete("latitude"),t.delete("longitude"),"?"+t.toString())}const cookieBannerAcceptSelector=".js-cookie-banner-accept",cookieBannerRejectSelector=".js-cookie-banner-reject",cookieBannerHideButtonSelector=".js-cookie-banner-hide",cookieMessageSelector=".js-cookie-banner-message",cookieConfirmationAcceptSelector=".js-cookie-banner-confirmation-accept",cookieConfirmationRejectSelector=".js-cookie-banner-confirmation-reject";function CookieBanner(e){this.$module=e}function CookiesPage(e){this.$module=e}function initializeAddAnother(){document.querySelectorAll('[data-module="fh-add-another"]').forEach((function(e){new window.FamilyHubsFrontend.AddAnother(e)}))}function initializeBackButtons(){if(history.length>1){nodeListForEach(document.querySelectorAll(".fh-back-link"),(e=>{e.style.display="block",e.addEventListener("click",(()=>{window.history.back()}))}))}}function initializeVisibilityToggles(){nodeListForEach(document.querySelectorAll("[data-toggle-visibility-id]"),(e=>{e.addEventListener("click",(function(t){let o=e.getAttribute("data-toggle-visibility-id");if(o){let e=document.getElementById(o);e&&("none"===e.style.display?e.style.display="block":e.style.display="none")}}))}))}CookieBanner.prototype.init=function(){if(this.$cookieBanner=this.$module,this.$acceptButton=this.$module.querySelector(".js-cookie-banner-accept"),this.$rejectButton=this.$module.querySelector(".js-cookie-banner-reject"),this.$cookieMessage=this.$module.querySelector(cookieMessageSelector),this.$cookieConfirmationAccept=this.$module.querySelector(cookieConfirmationAcceptSelector),this.$cookieConfirmationReject=this.$module.querySelector(cookieConfirmationRejectSelector),this.$cookieBannerHideButtons=this.$module.querySelectorAll(".js-cookie-banner-hide"),this.$cookieBanner&&!this.onCookiesPage()){var e=getConsentCookie();e&&isValidConsentCookie(e)||(resetCookies(),this.$cookieBanner.removeAttribute("hidden")),this.$acceptButton.addEventListener("click",this.acceptCookies.bind(this)),this.$rejectButton.addEventListener("click",this.rejectCookies.bind(this)),nodeListForEach(this.$cookieBannerHideButtons,function(e){e.addEventListener("click",this.hideBanner.bind(this))}.bind(this))}},CookieBanner.prototype.hideBanner=function(){this.$cookieBanner.setAttribute("hidden",!0)},CookieBanner.prototype.acceptCookies=function(){setConsentCookie({analytics:!0}),updateAnalyticsStorageConsent(!0),sendAnalyticsCustomEvent(!0,"banner"),sendPageViewEvent(),sendFilterPageCustomEvent(),this.$cookieMessage.setAttribute("hidden",!0),this.revealConfirmationMessage(this.$cookieConfirmationAccept)},CookieBanner.prototype.rejectCookies=function(){updateAnalyticsStorageConsent(!0),sendAnalyticsCustomEvent(!1,"banner"),updateAnalyticsStorageConsent(!1),setConsentCookie({analytics:!1}),this.$cookieMessage.setAttribute("hidden",!0),this.revealConfirmationMessage(this.$cookieConfirmationReject)},CookieBanner.prototype.revealConfirmationMessage=function(e){e.removeAttribute("hidden"),e.getAttribute("tabindex")||(e.setAttribute("tabindex","-1"),e.addEventListener("blur",(function(){e.removeAttribute("tabindex")}))),e.focus()},CookieBanner.prototype.onCookiesPage=function(){return"/cookies/"===window.location.pathname},CookiesPage.prototype.init=function(){this.$cookiePage=this.$module,this.$cookiePage&&(this.$cookieForm=this.$cookiePage.querySelector(".js-cookies-page-form"),this.$cookieFormFieldsets=this.$cookieForm.querySelectorAll(".js-cookies-page-form-fieldset"),this.$successNotification=this.$cookiePage.querySelector(".js-cookies-page-success"),this.$successLink=this.$cookiePage.querySelector(".js-cookies-page-success-link"),nodeListForEach(this.$cookieFormFieldsets,function(e){this.showUserPreference(e,getConsentCookie())}.bind(this)),this.$cookieForm.addEventListener("submit",this.savePreferences.bind(this)))},CookiesPage.prototype.savePreferences=function(e){e.preventDefault();var t={};nodeListForEach(this.$cookieFormFieldsets,function(e){var o=this.getCookieType(e),n=e.querySelector("input[name="+o+"]:checked").value;t[o]="true"===n}.bind(this)),updateAnalyticsStorageConsent(!0);const o=t.analytics;sendAnalyticsCustomEvent(o,"cookies"),o?sendPageViewEvent():updateAnalyticsStorageConsent(!1),setConsentCookie(t),document.querySelector('[data-module="govuk-cookie-banner"]').setAttribute("hidden","true"),this.showSuccessNotification()},CookiesPage.prototype.showUserPreference=function(e,t){var o=this.getCookieType(e),n=!1;o&&t&&void 0!==t[o]&&(n=t[o]);var i=n?"true":"false";e.querySelector("input[name="+o+"][value="+i+"]").checked=!0},CookiesPage.prototype.showSuccessNotification=function(){this.$successNotification.removeAttribute("hidden");var e=!!document.referrer&&new URL(document.referrer).pathname;e&&e!==document.location.pathname?(this.$successLink.href=e,this.$successLink.removeAttribute("hidden")):this.$successLink.setAttribute("hidden","true"),this.$successNotification.getAttribute("tabindex")||this.$successNotification.setAttribute("tabindex","-1"),this.$successNotification.focus(),window.scrollTo(0,0)},CookiesPage.prototype.getCookieType=function(e){return e.id},window.FamilyHubsFrontend=window.FamilyHubsFrontend||{},window.FamilyHubsFrontend.AddAnother=function(e){if(this.container=$(e),this.index=0,!this.container.data("fh-add-another-initialised")){var t=e.getAttribute("data-fh-add-another-callback");this.callback=null,document.addEventListener("DOMContentLoaded",function(){"function"==typeof window[t]&&(this.callback=window[t],this.callback(e))}.bind(this)),this.container.data("fh-add-another-initialised",!0),this.container.on("click",".fh-add-another__remove-button",$.proxy(this,"onRemoveButtonClick")),this.container.on("click",".fh-add-another__add-button",$.proxy(this,"onAddButtonClick")),this.container.find(".fh-add-another__add-button, fh-add-another__remove-button").prop("type","submit")}},window.FamilyHubsFrontend.AddAnother.prototype.onAddButtonClick=function(e){var t=this.getNewItem(),o=this.getItems().first();this.hasRemoveButton(o)||this.createRemoveButton(o),this.getItems().last().after(t),t.find("input, textarea, select").first().focus(),e.preventDefault()},window.FamilyHubsFrontend.AddAnother.prototype.hasRemoveButton=function(e){return e.find(".fh-add-another__remove-button").length},window.FamilyHubsFrontend.AddAnother.prototype.getItems=function(){return this.container.find(".fh-add-another__item")},window.FamilyHubsFrontend.AddAnother.prototype.stripErrorFromNewItem=function(e){e.querySelectorAll("div.govuk-form-group--error").forEach((function(e,t){e.classList.remove("govuk-form-group--error")})),e.querySelectorAll("p.govuk-error-message").forEach((function(e,t){e.parentNode.removeChild(e)})),e.querySelectorAll("select.govuk-select--error").forEach((function(e,t){e.classList.remove("govuk-select--error")})),e.querySelectorAll("input.govuk-input--error").forEach((function(e,t){e.classList.remove("govuk-input--error")}))},window.FamilyHubsFrontend.AddAnother.prototype.getNewItem=function(){const e=this.getItems()[0].cloneNode(!0);this.stripErrorFromNewItem(e);e.querySelectorAll(".autocomplete__wrapper").forEach((e=>{e.parentNode.parentNode&&e.parentNode.parentNode.removeChild(e.parentNode)}));var t=$(e);return this.updateAttributes(++this.index,t),this.resetItem(t),"function"==typeof this.callback&&this.callback(e),this.hasRemoveButton(t)||this.createRemoveButton(t),t},window.FamilyHubsFrontend.AddAnother.prototype.updateAttributes=function(e,t){t.find("[data-name]").each((function(o,n){var i=n.id;n.name=$(n).attr("data-name").replace(/%index%/,e),n.id=$(n).attr("data-id").replace(/%index%/,e),($(n).siblings("label")[0]||$(n).parents("label")[0]||t.find('[for="'+i+'"]')[0]).htmlFor=n.id}))},window.FamilyHubsFrontend.AddAnother.prototype.createRemoveButton=function(e){e.append('<button type="submit" class="govuk-button govuk-button--secondary fh-add-another__remove-button">Remove</button>')},window.FamilyHubsFrontend.AddAnother.prototype.resetItem=function(e){e.find("input, textarea, select").each((function(e,t){"checkbox"==t.type||"radio"==t.type?t.checked=!1:t.value=""}))},window.FamilyHubsFrontend.AddAnother.prototype.onRemoveButtonClick=function(e){$(e.currentTarget).parents(".fh-add-another__item").remove();var t=this.getItems();1===t.length&&t.find(".fh-add-another__remove-button").remove(),this.focusHeading(),e.preventDefault()},window.FamilyHubsFrontend.AddAnother.prototype.focusHeading=function(){this.container.find(".fh-add-another__heading").focus()};class OpenCloseButton{constructor(e){this.openCloseButton=e;const t=this.openCloseButton.getAttribute("data-open-close-mobile");this.target=document.getElementById(t),this.showText=this.openCloseButton.textContent,this.hideText=this.openCloseButton.getAttribute("data-open-close-mobile-hide"),this.target.classList.add("fh-open-close-target"),"hide"===this.openCloseButton.getAttribute("data-open-close-mobile-default")?this.hideTarget():this.showTarget(),this.openCloseButton.addEventListener("click",(e=>this.handleClick(e)))}handleClick(e){this.target.classList.contains("fh-open-close-target-user-opened")?this.hideTarget():this.showTarget()}showTarget(){this.target&&(this.target.classList.contains("fh-open-close-target-user-opened")||this.target.classList.add("fh-open-close-target-user-opened")),this.hideText&&(this.openCloseButton.textContent=this.hideText)}hideTarget(){this.target&&this.target.classList.remove("fh-open-close-target-user-opened"),this.showText&&(this.openCloseButton.textContent=this.showText)}}window.FamilyHubsFrontend=window.FamilyHubsFrontend||{},window.FamilyHubsFrontend.initAll=()=>{new CookieBanner(document.querySelector('[data-module="govuk-cookie-banner"]')).init(),initAnalytics(window.GA_MEASUREMENT_ID),new CookiesPage(document.querySelector('[data-module="fh-cookies-page"]')).init(),initializeBackButtons(),initializeVisibilityToggles(),initializeAddAnother();let e=document.querySelectorAll("button[data-open-close-mobile]");null==e||e.forEach((e=>{new OpenCloseButton(e)}))},window.GOVUKFrontend.initAll(),window.MOJFrontend.initAll(),window.FamilyHubsFrontend.initAll();
//# sourceMappingURL=familyhubs-frontend-7.3.1.min.js.map
