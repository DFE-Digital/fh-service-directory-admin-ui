{"version":3,"sources":["tmp/js/app.js"],"names":["fhgov","this","init","restoreConditionalInputs","enhanceAccessibleAutocomplete","element","document","querySelector","HTMLElement","click","modelLaOrganisationName","getElementById","accessibleAutocomplete","enhanceSelectElement","defaultValue","value","name","selectElement","modelVcsOrganisationName","selectLocationLocation","setupLanguageAutocompleteWhenAddAnother","languageSelects","querySelectorAll","MutationObserver","mutationsList","observer","childListMutation","some","mutation","type","addedNodes","length","attributesMutation","attributeName","targetElement","target","tagName","toLowerCase","getAttribute","forEach","select","input","id","replace","addGovUkClasses","classList","contains","observe","childList","subtree","attributes","errorState","add","window","addEventListener"],"mappings":"AAAA,SAASA,QACLC,KAAKC,KAAO,WACRC,IACAC,GACR,EACI,IAAID,EAA2B,WAC3B,MAAME,EAAUC,SAASC,cAAc,6BACnCF,aAAmBG,aACnBH,EAAQI,OAEpB,EACQL,EAAgC,WAEhC,MAAMM,EAA0BJ,SAASK,eAAe,2BACpDD,GACAE,uBAAuBC,qBAAqB,CACxCC,aAAcJ,EAAwBK,MACtCC,KAAM,qBACNC,cAAeX,SAASC,cAAc,yBAI9C,MAAMW,EAA2BZ,SAASK,eAAe,4BACrDO,GACAN,uBAAuBC,qBAAqB,CACxCC,aAAcI,EAAyBH,MACvCC,KAAM,sBACNC,cAAeX,SAASC,cAAc,0BAG9C,MAAMY,EAAyBb,SAASK,eAAe,4BACnDQ,GACAP,uBAAuBC,qBAAqB,CAKxCI,cAAeE,GAG/B,CACA,CAKA,SAASC,wCAAwCf,GAC7C,KAAMA,aAAmBG,aACrB,OAEJ,MAAMa,EAAkBhB,EAAQiB,iBAAiB,2BAkB7B,IAAIC,kBAAiB,CAACC,EAAeC,KACrD,MAAMC,EAAoBF,EAAcG,MAAKC,GAA8B,cAAlBA,EAASC,MAAwBD,EAASE,WAAWC,OAAS,IACjHC,EAAqBR,EAAcG,MAAKC,IAC1C,GAAsB,eAAlBA,EAASC,MAAoD,UAA3BD,EAASK,cAA2B,CACtE,MAAMC,EAAgBN,EAASO,OAC/B,MAA+C,UAAxCD,EAAcE,QAAQC,eAAoE,SAAvCH,EAAcI,aAAa,OACrG,CACY,OAAO,CAAK,KAQZZ,GAAqBM,IAErBX,EAAgBkB,SAAQ,SAAUC,GAE9B,MAAMC,EAAQnC,SAASK,eAAe6B,EAAOE,GAAGC,QAAQ,UAAW,KAGnE,IAAKF,EAED,OAGJG,gBAAgBH,EADGD,EAAOK,UAAUC,SAAS,uBAE7D,GACA,IAEgBC,QAAQ1C,EAAS,CAAE2C,WAAW,EAAMC,SAAS,EAAMC,YAAY,IAC3E7B,EAAgBkB,SAAQ,SAAUC,GAC9B5B,uBAAuBC,qBAAqB,CACxCG,KAAM,eACNF,aAAc,GACdG,cAAeuB,GAE3B,GACA,CACA,SAASI,gBAAgBH,EAAOU,GACvBV,EAAMI,UAAUC,SAAS,gBAC1BL,EAAMI,UAAUO,IAAI,eAEpBD,IAAeV,EAAMI,UAAUC,SAAS,uBACxCL,EAAMI,UAAUO,IAAI,qBAE5B,CAzEAC,OAAOrD,MAAQ,IAAIA,MACnBM,SAASgD,iBAAiB,oBAAoB,WAC1CD,OAAOrD,MAAME,MACjB,IA2EAkB,wCAAwC","file":"app.js","sourcesContent":["function fhgov() {\n    this.init = function () {\n        restoreConditionalInputs();\n        enhanceAccessibleAutocomplete();\n    };\n    let restoreConditionalInputs = function () {\n        const element = document.querySelector(\"[data-conditional-active]\");\n        if (element instanceof HTMLElement) {\n            element.click();\n        }\n    };\n    let enhanceAccessibleAutocomplete = function () {\n        //WhichLocalAuthority.cshtml && AddOrganisationWhichLocalAuthority.cshtml\n        const modelLaOrganisationName = document.getElementById('modelLaOrganisationName');\n        if (modelLaOrganisationName) {\n            accessibleAutocomplete.enhanceSelectElement({\n                defaultValue: modelLaOrganisationName.value,\n                name: 'LaOrganisationName',\n                selectElement: document.querySelector('#LaOrganisationName')\n            });\n        }\n        //WhichVcsOrganisation.cshtml\n        const modelVcsOrganisationName = document.getElementById('modelVcsOrganisationName');\n        if (modelVcsOrganisationName) {\n            accessibleAutocomplete.enhanceSelectElement({\n                defaultValue: modelVcsOrganisationName.value,\n                name: 'VcsOrganisationName',\n                selectElement: document.querySelector('#VcsOrganisationName')\n            });\n        }\n        const selectLocationLocation = document.getElementById('select-location-location');\n        if (selectLocationLocation) {\n            accessibleAutocomplete.enhanceSelectElement({\n                //Default the autocomplete name attribute to '' to prevent it being included in form submissions\n                //Upon confirming a value in the autocomplete, update the original <select>\n                // ^^ from docs. does that mean requires js??\n                //name: 'location',\n                selectElement: selectLocationLocation\n            });\n        }\n    };\n}\nwindow.fhgov = new fhgov();\ndocument.addEventListener('DOMContentLoaded', function () {\n    window.fhgov.init();\n});\nfunction setupLanguageAutocompleteWhenAddAnother(element) {\n    if (!(element instanceof HTMLElement)) {\n        return;\n    }\n    const languageSelects = element.querySelectorAll(\"select[id^='language-']\");\n    /*    console.log('enhancing ' + languageSelects.length + ' language selects');*/\n    // work around accessible-autocomplete not handling errors or using standard govuk styling classes\n    // there's a discussion about handling errors here...\n    // https://github.com/alphagov/accessible-autocomplete/issues/428\n    // but we've had to implement our own (hacky) solution by using MutationObserver\n    // and adding extra classes (with custom css) to the input element.\n    // we are observing the DOM for changes because enhanceSelectElement() ultimately\n    // calls render in Peact, which schedules an update to the DOM, rather than immediately updating the DOM.\n    // (if we forked the accessible-autocomplete component, we could use componentDidMount or useEffect instead).\n    // we also observe any changes to the class attribute of the text input elements,\n    // as any changes we make to the input element's class attribute will be overwritten by the component (on focus etc.).\n    // I was going to either package up this code into an exported function to ease reuse and maintanence,\n    // or fork the accessible-autocomplete preact component,\n    // but someone is adding official support today (2024-01-12) so we should be able to remove this soon!\n    // https://github.com/alphagov/accessible-autocomplete/pull/602\n    //todo: fix aria-describedBy on the input too\n    // see https://github.com/alphagov/accessible-autocomplete/issues/589\n    const domObserver = new MutationObserver((mutationsList, observer) => {\n        const childListMutation = mutationsList.some(mutation => mutation.type === 'childList' && mutation.addedNodes.length > 0);\n        const attributesMutation = mutationsList.some(mutation => {\n            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                const targetElement = mutation.target;\n                return targetElement.tagName.toLowerCase() === 'input' && targetElement.getAttribute('type') === 'text';\n            }\n            return false;\n        });\n        //if (childListMutation) {\n        //    console.log('childListMutation');\n        //}\n        //if (attributesMutation) {\n        //    console.log('attributesMutation');\n        //}\n        if (childListMutation || attributesMutation) {\n            /*todo: create list of input ids outside of observer? */\n            languageSelects.forEach(function (select) {\n                //console.log(select.id);\n                const input = document.getElementById(select.id.replace('-select', ''));\n                //console.log(input);\n                // input should never be null now we're observing the DOM for changes, but we check it for extra safety\n                if (!input) {\n                    //console.log('no input found for select')\n                    return;\n                }\n                const errorState = select.classList.contains('govuk-select--error');\n                addGovUkClasses(input, errorState);\n            });\n        }\n    });\n    domObserver.observe(element, { childList: true, subtree: true, attributes: true });\n    languageSelects.forEach(function (select) {\n        accessibleAutocomplete.enhanceSelectElement({\n            name: 'languageName',\n            defaultValue: '',\n            selectElement: select\n        });\n    });\n}\nfunction addGovUkClasses(input, errorState) {\n    if (!input.classList.contains('govuk-input')) {\n        input.classList.add('govuk-input');\n    }\n    if (errorState && !input.classList.contains('govuk-input--error')) {\n        input.classList.add('govuk-input--error');\n    }\n}\n//todo: this is a hack - we want setupLanguageAutocompleteWhenAddAnother to be in the generated js file.\n// if we export it, it includes the export keyword in the generated js file\n// (but we use export in the other ts files, without the js containing export!)\n// so as a workaround we call it where it no-ops\nsetupLanguageAutocompleteWhenAddAnother(null);\nexport {};\n//});\n\n//# sourceMappingURL=data:application/json;charset=utf8;base64,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UUFDUCxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxXQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUVuRixlQUFlLENBQUMsT0FBTyxDQUFDLFVBQVUsTUFBTTtRQUNwQyxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQztZQUN4QyxJQUFJLEVBQUUsY0FBYztZQUNwQixZQUFZLEVBQUUsRUFBRTtZQUNoQixhQUFhLEVBQUUsTUFBTTtTQUN4QixDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxLQUF1QixFQUFFLFVBQW1CO0lBQ2pFLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO1FBQzNDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxJQUFJLFVBQVUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztRQUNoRSxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzlDLENBQUM7QUFDTCxDQUFDO0FBRUQsd0dBQXdHO0FBQ3hHLDJFQUEyRTtBQUMzRSwrRUFBK0U7QUFDL0UsZ0RBQWdEO0FBQ2hELHVDQUF1QyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUM5QyxLQUFLIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IH07XHJcblxyXG5kZWNsYXJlIGNvbnN0IGFjY2Vzc2libGVBdXRvY29tcGxldGU6IGFueTtcclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gICAgaW50ZXJmYWNlIFdpbmRvdyB7XHJcbiAgICAgICAgZmhnb3Y6IGFueTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZmhnb3YoKSB7XHJcbiAgICB0aGlzLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmVzdG9yZUNvbmRpdGlvbmFsSW5wdXRzKCk7XHJcbiAgICAgICAgZW5oYW5jZUFjY2Vzc2libGVBdXRvY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgbGV0IHJlc3RvcmVDb25kaXRpb25hbElucHV0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIltkYXRhLWNvbmRpdGlvbmFsLWFjdGl2ZV1cIik7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LmNsaWNrKClcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGxldCBlbmhhbmNlQWNjZXNzaWJsZUF1dG9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgLy9XaGljaExvY2FsQXV0aG9yaXR5LmNzaHRtbCAmJiBBZGRPcmdhbmlzYXRpb25XaGljaExvY2FsQXV0aG9yaXR5LmNzaHRtbFxyXG4gICAgICAgIGNvbnN0IG1vZGVsTGFPcmdhbmlzYXRpb25OYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGVsTGFPcmdhbmlzYXRpb25OYW1lJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICBpZiAobW9kZWxMYU9yZ2FuaXNhdGlvbk5hbWUpIHtcclxuICAgICAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IG1vZGVsTGFPcmdhbmlzYXRpb25OYW1lLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ0xhT3JnYW5pc2F0aW9uTmFtZScsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RFbGVtZW50OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjTGFPcmdhbmlzYXRpb25OYW1lJylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1doaWNoVmNzT3JnYW5pc2F0aW9uLmNzaHRtbFxyXG4gICAgICAgIGNvbnN0IG1vZGVsVmNzT3JnYW5pc2F0aW9uTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlbFZjc09yZ2FuaXNhdGlvbk5hbWUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIGlmIChtb2RlbFZjc09yZ2FuaXNhdGlvbk5hbWUpIHtcclxuICAgICAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IG1vZGVsVmNzT3JnYW5pc2F0aW9uTmFtZS52YWx1ZSxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdWY3NPcmdhbmlzYXRpb25OYW1lJyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNWY3NPcmdhbmlzYXRpb25OYW1lJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNlbGVjdExvY2F0aW9uTG9jYXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWxvY2F0aW9uLWxvY2F0aW9uJykgYXMgSFRNTFNlbGVjdEVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKHNlbGVjdExvY2F0aW9uTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XHJcbiAgICAgICAgICAgICAgICAvL0RlZmF1bHQgdGhlIGF1dG9jb21wbGV0ZSBuYW1lIGF0dHJpYnV0ZSB0byAnJyB0byBwcmV2ZW50IGl0IGJlaW5nIGluY2x1ZGVkIGluIGZvcm0gc3VibWlzc2lvbnNcclxuICAgICAgICAgICAgICAgIC8vVXBvbiBjb25maXJtaW5nIGEgdmFsdWUgaW4gdGhlIGF1dG9jb21wbGV0ZSwgdXBkYXRlIHRoZSBvcmlnaW5hbCA8c2VsZWN0PlxyXG4gICAgICAgICAgICAgICAgLy8gXl4gZnJvbSBkb2NzLiBkb2VzIHRoYXQgbWVhbiByZXF1aXJlcyBqcz8/XHJcbiAgICAgICAgICAgICAgICAvL25hbWU6ICdsb2NhdGlvbicsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RFbGVtZW50OiBzZWxlY3RMb2NhdGlvbkxvY2F0aW9uXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG53aW5kb3cuZmhnb3YgPSBuZXcgZmhnb3YoKTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICB3aW5kb3cuZmhnb3YuaW5pdCgpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIHNldHVwTGFuZ3VhZ2VBdXRvY29tcGxldGVXaGVuQWRkQW5vdGhlcihlbGVtZW50OiBIVE1MRWxlbWVudCkge1xyXG5cclxuICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGFuZ3VhZ2VTZWxlY3RzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwic2VsZWN0W2lkXj0nbGFuZ3VhZ2UtJ11cIikgYXMgTm9kZUxpc3RPZjxIVE1MU2VsZWN0RWxlbWVudD47XHJcblxyXG4vKiAgICBjb25zb2xlLmxvZygnZW5oYW5jaW5nICcgKyBsYW5ndWFnZVNlbGVjdHMubGVuZ3RoICsgJyBsYW5ndWFnZSBzZWxlY3RzJyk7Ki9cclxuXHJcbiAgICAvLyB3b3JrIGFyb3VuZCBhY2Nlc3NpYmxlLWF1dG9jb21wbGV0ZSBub3QgaGFuZGxpbmcgZXJyb3JzIG9yIHVzaW5nIHN0YW5kYXJkIGdvdnVrIHN0eWxpbmcgY2xhc3Nlc1xyXG4gICAgLy8gdGhlcmUncyBhIGRpc2N1c3Npb24gYWJvdXQgaGFuZGxpbmcgZXJyb3JzIGhlcmUuLi5cclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHBoYWdvdi9hY2Nlc3NpYmxlLWF1dG9jb21wbGV0ZS9pc3N1ZXMvNDI4XHJcbiAgICAvLyBidXQgd2UndmUgaGFkIHRvIGltcGxlbWVudCBvdXIgb3duIChoYWNreSkgc29sdXRpb24gYnkgdXNpbmcgTXV0YXRpb25PYnNlcnZlclxyXG4gICAgLy8gYW5kIGFkZGluZyBleHRyYSBjbGFzc2VzICh3aXRoIGN1c3RvbSBjc3MpIHRvIHRoZSBpbnB1dCBlbGVtZW50LlxyXG4gICAgLy8gd2UgYXJlIG9ic2VydmluZyB0aGUgRE9NIGZvciBjaGFuZ2VzIGJlY2F1c2UgZW5oYW5jZVNlbGVjdEVsZW1lbnQoKSB1bHRpbWF0ZWx5XHJcbiAgICAvLyBjYWxscyByZW5kZXIgaW4gUGVhY3QsIHdoaWNoIHNjaGVkdWxlcyBhbiB1cGRhdGUgdG8gdGhlIERPTSwgcmF0aGVyIHRoYW4gaW1tZWRpYXRlbHkgdXBkYXRpbmcgdGhlIERPTS5cclxuICAgIC8vIChpZiB3ZSBmb3JrZWQgdGhlIGFjY2Vzc2libGUtYXV0b2NvbXBsZXRlIGNvbXBvbmVudCwgd2UgY291bGQgdXNlIGNvbXBvbmVudERpZE1vdW50IG9yIHVzZUVmZmVjdCBpbnN0ZWFkKS5cclxuICAgIC8vIHdlIGFsc28gb2JzZXJ2ZSBhbnkgY2hhbmdlcyB0byB0aGUgY2xhc3MgYXR0cmlidXRlIG9mIHRoZSB0ZXh0IGlucHV0IGVsZW1lbnRzLFxyXG4gICAgLy8gYXMgYW55IGNoYW5nZXMgd2UgbWFrZSB0byB0aGUgaW5wdXQgZWxlbWVudCdzIGNsYXNzIGF0dHJpYnV0ZSB3aWxsIGJlIG92ZXJ3cml0dGVuIGJ5IHRoZSBjb21wb25lbnQgKG9uIGZvY3VzIGV0Yy4pLlxyXG5cclxuICAgIC8vIEkgd2FzIGdvaW5nIHRvIGVpdGhlciBwYWNrYWdlIHVwIHRoaXMgY29kZSBpbnRvIGFuIGV4cG9ydGVkIGZ1bmN0aW9uIHRvIGVhc2UgcmV1c2UgYW5kIG1haW50YW5lbmNlLFxyXG4gICAgLy8gb3IgZm9yayB0aGUgYWNjZXNzaWJsZS1hdXRvY29tcGxldGUgcHJlYWN0IGNvbXBvbmVudCxcclxuICAgIC8vIGJ1dCBzb21lb25lIGlzIGFkZGluZyBvZmZpY2lhbCBzdXBwb3J0IHRvZGF5ICgyMDI0LTAxLTEyKSBzbyB3ZSBzaG91bGQgYmUgYWJsZSB0byByZW1vdmUgdGhpcyBzb29uIVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FscGhhZ292L2FjY2Vzc2libGUtYXV0b2NvbXBsZXRlL3B1bGwvNjAyXHJcblxyXG4gICAgLy90b2RvOiBmaXggYXJpYS1kZXNjcmliZWRCeSBvbiB0aGUgaW5wdXQgdG9vXHJcbiAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FscGhhZ292L2FjY2Vzc2libGUtYXV0b2NvbXBsZXRlL2lzc3Vlcy81ODlcclxuXHJcbiAgICBjb25zdCBkb21PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnNMaXN0LCBvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkTGlzdE11dGF0aW9uID0gbXV0YXRpb25zTGlzdC5zb21lKG11dGF0aW9uID0+IG11dGF0aW9uLnR5cGUgPT09ICdjaGlsZExpc3QnICYmIG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoID4gMCk7XHJcbiAgICAgICAgY29uc3QgYXR0cmlidXRlc011dGF0aW9uID0gbXV0YXRpb25zTGlzdC5zb21lKG11dGF0aW9uID0+IHtcclxuICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAnY2xhc3MnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRFbGVtZW50ID0gbXV0YXRpb24udGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnICYmIHRhcmdldEVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0eXBlJykgPT09ICd0ZXh0JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vaWYgKGNoaWxkTGlzdE11dGF0aW9uKSB7XHJcbiAgICAgICAgLy8gICAgY29uc29sZS5sb2coJ2NoaWxkTGlzdE11dGF0aW9uJyk7XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIC8vaWYgKGF0dHJpYnV0ZXNNdXRhdGlvbikge1xyXG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKCdhdHRyaWJ1dGVzTXV0YXRpb24nKTtcclxuICAgICAgICAvL31cclxuXHJcbiAgICAgICAgaWYgKGNoaWxkTGlzdE11dGF0aW9uIHx8IGF0dHJpYnV0ZXNNdXRhdGlvbikge1xyXG4gICAgICAgICAgICAvKnRvZG86IGNyZWF0ZSBsaXN0IG9mIGlucHV0IGlkcyBvdXRzaWRlIG9mIG9ic2VydmVyPyAqL1xyXG4gICAgICAgICAgICBsYW5ndWFnZVNlbGVjdHMuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNlbGVjdC5pZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdC5pZC5yZXBsYWNlKCctc2VsZWN0JywgJycpKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpbnB1dCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaW5wdXQgc2hvdWxkIG5ldmVyIGJlIG51bGwgbm93IHdlJ3JlIG9ic2VydmluZyB0aGUgRE9NIGZvciBjaGFuZ2VzLCBidXQgd2UgY2hlY2sgaXQgZm9yIGV4dHJhIHNhZmV0eVxyXG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ25vIGlucHV0IGZvdW5kIGZvciBzZWxlY3QnKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvclN0YXRlID0gc2VsZWN0LmNsYXNzTGlzdC5jb250YWlucygnZ292dWstc2VsZWN0LS1lcnJvcicpO1xyXG5cclxuICAgICAgICAgICAgICAgIGFkZEdvdlVrQ2xhc3NlcyhpbnB1dCwgZXJyb3JTdGF0ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGRvbU9ic2VydmVyLm9ic2VydmUoZWxlbWVudCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUsIGF0dHJpYnV0ZXM6IHRydWUgfSk7XHJcblxyXG4gICAgbGFuZ3VhZ2VTZWxlY3RzLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdCkge1xyXG4gICAgICAgIGFjY2Vzc2libGVBdXRvY29tcGxldGUuZW5oYW5jZVNlbGVjdEVsZW1lbnQoe1xyXG4gICAgICAgICAgICBuYW1lOiAnbGFuZ3VhZ2VOYW1lJyxcclxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcclxuICAgICAgICAgICAgc2VsZWN0RWxlbWVudDogc2VsZWN0XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkR292VWtDbGFzc2VzKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCBlcnJvclN0YXRlOiBib29sZWFuKSB7XHJcbiAgICBpZiAoIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZ292dWstaW5wdXQnKSkge1xyXG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2dvdnVrLWlucHV0Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGVycm9yU3RhdGUgJiYgIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZ292dWstaW5wdXQtLWVycm9yJykpIHtcclxuICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdnb3Z1ay1pbnB1dC0tZXJyb3InKTtcclxuICAgIH1cclxufVxyXG5cclxuLy90b2RvOiB0aGlzIGlzIGEgaGFjayAtIHdlIHdhbnQgc2V0dXBMYW5ndWFnZUF1dG9jb21wbGV0ZVdoZW5BZGRBbm90aGVyIHRvIGJlIGluIHRoZSBnZW5lcmF0ZWQganMgZmlsZS5cclxuLy8gaWYgd2UgZXhwb3J0IGl0LCBpdCBpbmNsdWRlcyB0aGUgZXhwb3J0IGtleXdvcmQgaW4gdGhlIGdlbmVyYXRlZCBqcyBmaWxlXHJcbi8vIChidXQgd2UgdXNlIGV4cG9ydCBpbiB0aGUgb3RoZXIgdHMgZmlsZXMsIHdpdGhvdXQgdGhlIGpzIGNvbnRhaW5pbmcgZXhwb3J0ISlcclxuLy8gc28gYXMgYSB3b3JrYXJvdW5kIHdlIGNhbGwgaXQgd2hlcmUgaXQgbm8tb3BzXHJcbnNldHVwTGFuZ3VhZ2VBdXRvY29tcGxldGVXaGVuQWRkQW5vdGhlcihudWxsKTtcclxuLy99KTsiXX0=\n"]}