{"version":3,"sources":["tmp/js/app.js"],"names":["fhgov","this","init","restoreConditionalInputs","enhanceAccessibleAutocomplete","element","document","querySelector","HTMLElement","click","modelLaOrganisationName","getElementById","accessibleAutocomplete","enhanceSelectElement","defaultValue","value","name","selectElement","modelVcsOrganisationName","selectLocationLocation","setupLanguageAutocompleteWhenAddAnother","languageSelects","querySelectorAll","MutationObserver","mutationsList","observer","childListMutation","some","mutation","type","addedNodes","length","attributesMutation","attributeName","targetElement","target","tagName","toLowerCase","getAttribute","forEach","select","input","id","replace","addGovUkClasses","classList","contains","observe","childList","subtree","attributes","errorState","add","window","addEventListener"],"mappings":"AAAA,SAASA,QACLC,KAAKC,KAAO,WACRC,IACAC,GACR,EACI,IAAID,EAA2B,WAC3B,MAAME,EAAUC,SAASC,cAAc,6BACnCF,aAAmBG,aACnBH,EAAQI,OAEpB,EACQL,EAAgC,WAEhC,MAAMM,EAA0BJ,SAASK,eAAe,2BACpDD,GACAE,uBAAuBC,qBAAqB,CACxCC,aAAcJ,EAAwBK,MACtCC,KAAM,qBACNC,cAAeX,SAASC,cAAc,yBAI9C,MAAMW,EAA2BZ,SAASK,eAAe,4BACrDO,GACAN,uBAAuBC,qBAAqB,CACxCC,aAAcI,EAAyBH,MACvCC,KAAM,sBACNC,cAAeX,SAASC,cAAc,0BAG9C,MAAMY,EAAyBb,SAASK,eAAe,4BACnDQ,GACAP,uBAAuBC,qBAAqB,CACxCI,cAAeE,GAG/B,CACA,CAKA,SAASC,wCAAwCf,GAC7C,KAAMA,aAAmBG,aACrB,OAEJ,MAAMa,EAAkBhB,EAAQiB,iBAAiB,2BAkB7B,IAAIC,kBAAiB,CAACC,EAAeC,KACrD,MAAMC,EAAoBF,EAAcG,MAAKC,GAA8B,cAAlBA,EAASC,MAAwBD,EAASE,WAAWC,OAAS,IACjHC,EAAqBR,EAAcG,MAAKC,IAC1C,GAAsB,eAAlBA,EAASC,MAAoD,UAA3BD,EAASK,cAA2B,CACtE,MAAMC,EAAgBN,EAASO,OAC/B,MAA+C,UAAxCD,EAAcE,QAAQC,eAAoE,SAAvCH,EAAcI,aAAa,OACrG,CACY,OAAO,CAAK,KAQZZ,GAAqBM,IAErBX,EAAgBkB,SAAQ,SAAUC,GAE9B,MAAMC,EAAQnC,SAASK,eAAe6B,EAAOE,GAAGC,QAAQ,UAAW,KAGnE,IAAKF,EAED,OAGJG,gBAAgBH,EADGD,EAAOK,UAAUC,SAAS,uBAE7D,GACA,IAEgBC,QAAQ1C,EAAS,CAAE2C,WAAW,EAAMC,SAAS,EAAMC,YAAY,IAC3E7B,EAAgBkB,SAAQ,SAAUC,GAC9B5B,uBAAuBC,qBAAqB,CACxCG,KAAM,eACNF,aAAc,GACdG,cAAeuB,GAE3B,GACA,CACA,SAASI,gBAAgBH,EAAOU,GACvBV,EAAMI,UAAUC,SAAS,gBAC1BL,EAAMI,UAAUO,IAAI,eAEpBD,IAAeV,EAAMI,UAAUC,SAAS,uBACxCL,EAAMI,UAAUO,IAAI,qBAE5B,CAzEAC,OAAOrD,MAAQ,IAAIA,MACnBM,SAASgD,iBAAiB,oBAAoB,WAC1CD,OAAOrD,MAAME,MACjB,IA2EAkB,wCAAwC","file":"app.js","sourcesContent":["function fhgov() {\n    this.init = function () {\n        restoreConditionalInputs();\n        enhanceAccessibleAutocomplete();\n    };\n    let restoreConditionalInputs = function () {\n        const element = document.querySelector(\"[data-conditional-active]\");\n        if (element instanceof HTMLElement) {\n            element.click();\n        }\n    };\n    let enhanceAccessibleAutocomplete = function () {\n        //WhichLocalAuthority.cshtml && AddOrganisationWhichLocalAuthority.cshtml\n        const modelLaOrganisationName = document.getElementById('modelLaOrganisationName');\n        if (modelLaOrganisationName) {\n            accessibleAutocomplete.enhanceSelectElement({\n                defaultValue: modelLaOrganisationName.value,\n                name: 'LaOrganisationName',\n                selectElement: document.querySelector('#LaOrganisationName')\n            });\n        }\n        //WhichVcsOrganisation.cshtml\n        const modelVcsOrganisationName = document.getElementById('modelVcsOrganisationName');\n        if (modelVcsOrganisationName) {\n            accessibleAutocomplete.enhanceSelectElement({\n                defaultValue: modelVcsOrganisationName.value,\n                name: 'VcsOrganisationName',\n                selectElement: document.querySelector('#VcsOrganisationName')\n            });\n        }\n        const selectLocationLocation = document.getElementById('select-location-location');\n        if (selectLocationLocation) {\n            accessibleAutocomplete.enhanceSelectElement({\n                selectElement: selectLocationLocation\n            });\n        }\n    };\n}\nwindow.fhgov = new fhgov();\ndocument.addEventListener('DOMContentLoaded', function () {\n    window.fhgov.init();\n});\nfunction setupLanguageAutocompleteWhenAddAnother(element) {\n    if (!(element instanceof HTMLElement)) {\n        return;\n    }\n    const languageSelects = element.querySelectorAll(\"select[id^='language-']\");\n    /*    console.log('enhancing ' + languageSelects.length + ' language selects');*/\n    // work around accessible-autocomplete not handling errors or using standard govuk styling classes\n    // there's a discussion about handling errors here...\n    // https://github.com/alphagov/accessible-autocomplete/issues/428\n    // but we've had to implement our own (hacky) solution by using MutationObserver\n    // and adding extra classes (with custom css) to the input element.\n    // we are observing the DOM for changes because enhanceSelectElement() ultimately\n    // calls render in Peact, which schedules an update to the DOM, rather than immediately updating the DOM.\n    // (if we forked the accessible-autocomplete component, we could use componentDidMount or useEffect instead).\n    // we also observe any changes to the class attribute of the text input elements,\n    // as any changes we make to the input element's class attribute will be overwritten by the component (on focus etc.).\n    // I was going to either package up this code into an exported function to ease reuse and maintanence,\n    // or fork the accessible-autocomplete preact component,\n    // but someone is adding official support today (2024-01-12) so we should be able to remove this soon!\n    // https://github.com/alphagov/accessible-autocomplete/pull/602\n    //todo: fix aria-describedBy on the input too\n    // see https://github.com/alphagov/accessible-autocomplete/issues/589\n    const domObserver = new MutationObserver((mutationsList, observer) => {\n        const childListMutation = mutationsList.some(mutation => mutation.type === 'childList' && mutation.addedNodes.length > 0);\n        const attributesMutation = mutationsList.some(mutation => {\n            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                const targetElement = mutation.target;\n                return targetElement.tagName.toLowerCase() === 'input' && targetElement.getAttribute('type') === 'text';\n            }\n            return false;\n        });\n        //if (childListMutation) {\n        //    console.log('childListMutation');\n        //}\n        //if (attributesMutation) {\n        //    console.log('attributesMutation');\n        //}\n        if (childListMutation || attributesMutation) {\n            /*todo: create list of input ids outside of observer? */\n            languageSelects.forEach(function (select) {\n                //console.log(select.id);\n                const input = document.getElementById(select.id.replace('-select', ''));\n                //console.log(input);\n                // input should never be null now we're observing the DOM for changes, but we check it for extra safety\n                if (!input) {\n                    //console.log('no input found for select')\n                    return;\n                }\n                const errorState = select.classList.contains('govuk-select--error');\n                addGovUkClasses(input, errorState);\n            });\n        }\n    });\n    domObserver.observe(element, { childList: true, subtree: true, attributes: true });\n    languageSelects.forEach(function (select) {\n        accessibleAutocomplete.enhanceSelectElement({\n            name: 'languageName',\n            defaultValue: '',\n            selectElement: select\n        });\n    });\n}\nfunction addGovUkClasses(input, errorState) {\n    if (!input.classList.contains('govuk-input')) {\n        input.classList.add('govuk-input');\n    }\n    if (errorState && !input.classList.contains('govuk-input--error')) {\n        input.classList.add('govuk-input--error');\n    }\n}\n//todo: this is a hack - we want setupLanguageAutocompleteWhenAddAnother to be in the generated js file.\n// if we export it, it includes the export keyword in the generated js file\n// (but we use export in the other ts files, without the js containing export!)\n// so as a workaround we call it where it no-ops\nsetupLanguageAutocompleteWhenAddAnother(null);\nexport {};\n//});\n\n//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFFbkYsZUFBZSxDQUFDLE9BQU8sQ0FBQyxVQUFVLE1BQU07UUFDcEMsc0JBQXNCLENBQUMsb0JBQW9CLENBQUM7WUFDeEMsSUFBSSxFQUFFLGNBQWM7WUFDcEIsWUFBWSxFQUFFLEVBQUU7WUFDaEIsYUFBYSxFQUFFLE1BQU07U0FDeEIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsU0FBUyxlQUFlLENBQUMsS0FBdUIsRUFBRSxVQUFtQjtJQUNqRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUMzQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsSUFBSSxVQUFVLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLENBQUM7UUFDaEUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUM5QyxDQUFDO0FBQ0wsQ0FBQztBQUVELHdHQUF3RztBQUN4RywyRUFBMkU7QUFDM0UsK0VBQStFO0FBQy9FLGdEQUFnRDtBQUNoRCx1Q0FBdUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFDOUMsS0FBSyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyB9O1xuXG5kZWNsYXJlIGNvbnN0IGFjY2Vzc2libGVBdXRvY29tcGxldGU6IGFueTtcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICAgICAgZmhnb3Y6IGFueTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGZoZ292KCkge1xuICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzdG9yZUNvbmRpdGlvbmFsSW5wdXRzKCk7XG4gICAgICAgIGVuaGFuY2VBY2Nlc3NpYmxlQXV0b2NvbXBsZXRlKCk7XG4gICAgfTtcblxuICAgIGxldCByZXN0b3JlQ29uZGl0aW9uYWxJbnB1dHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW2RhdGEtY29uZGl0aW9uYWwtYWN0aXZlXVwiKTtcbiAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC5jbGljaygpXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGxldCBlbmhhbmNlQWNjZXNzaWJsZUF1dG9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvL1doaWNoTG9jYWxBdXRob3JpdHkuY3NodG1sICYmIEFkZE9yZ2FuaXNhdGlvbldoaWNoTG9jYWxBdXRob3JpdHkuY3NodG1sXG4gICAgICAgIGNvbnN0IG1vZGVsTGFPcmdhbmlzYXRpb25OYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGVsTGFPcmdhbmlzYXRpb25OYW1lJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgaWYgKG1vZGVsTGFPcmdhbmlzYXRpb25OYW1lKSB7XG4gICAgICAgICAgICBhY2Nlc3NpYmxlQXV0b2NvbXBsZXRlLmVuaGFuY2VTZWxlY3RFbGVtZW50KHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IG1vZGVsTGFPcmdhbmlzYXRpb25OYW1lLnZhbHVlLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdMYU9yZ2FuaXNhdGlvbk5hbWUnLFxuICAgICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNMYU9yZ2FuaXNhdGlvbk5hbWUnKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL1doaWNoVmNzT3JnYW5pc2F0aW9uLmNzaHRtbFxuICAgICAgICBjb25zdCBtb2RlbFZjc09yZ2FuaXNhdGlvbk5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kZWxWY3NPcmdhbmlzYXRpb25OYW1lJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgaWYgKG1vZGVsVmNzT3JnYW5pc2F0aW9uTmFtZSkge1xuICAgICAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XG4gICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBtb2RlbFZjc09yZ2FuaXNhdGlvbk5hbWUudmFsdWUsXG4gICAgICAgICAgICAgICAgbmFtZTogJ1Zjc09yZ2FuaXNhdGlvbk5hbWUnLFxuICAgICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNWY3NPcmdhbmlzYXRpb25OYW1lJylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzZWxlY3RMb2NhdGlvbkxvY2F0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1sb2NhdGlvbi1sb2NhdGlvbicpIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xuICAgICAgICBpZiAoc2VsZWN0TG9jYXRpb25Mb2NhdGlvbikge1xuICAgICAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XG4gICAgICAgICAgICAgICAgc2VsZWN0RWxlbWVudDogc2VsZWN0TG9jYXRpb25Mb2NhdGlvblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxud2luZG93LmZoZ292ID0gbmV3IGZoZ292KCk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgd2luZG93LmZoZ292LmluaXQoKTtcbn0pO1xuXG5mdW5jdGlvbiBzZXR1cExhbmd1YWdlQXV0b2NvbXBsZXRlV2hlbkFkZEFub3RoZXIoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcblxuICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGxhbmd1YWdlU2VsZWN0cyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcInNlbGVjdFtpZF49J2xhbmd1YWdlLSddXCIpIGFzIE5vZGVMaXN0T2Y8SFRNTFNlbGVjdEVsZW1lbnQ+O1xuXG4vKiAgICBjb25zb2xlLmxvZygnZW5oYW5jaW5nICcgKyBsYW5ndWFnZVNlbGVjdHMubGVuZ3RoICsgJyBsYW5ndWFnZSBzZWxlY3RzJyk7Ki9cblxuICAgIC8vIHdvcmsgYXJvdW5kIGFjY2Vzc2libGUtYXV0b2NvbXBsZXRlIG5vdCBoYW5kbGluZyBlcnJvcnMgb3IgdXNpbmcgc3RhbmRhcmQgZ292dWsgc3R5bGluZyBjbGFzc2VzXG4gICAgLy8gdGhlcmUncyBhIGRpc2N1c3Npb24gYWJvdXQgaGFuZGxpbmcgZXJyb3JzIGhlcmUuLi5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYWxwaGFnb3YvYWNjZXNzaWJsZS1hdXRvY29tcGxldGUvaXNzdWVzLzQyOFxuICAgIC8vIGJ1dCB3ZSd2ZSBoYWQgdG8gaW1wbGVtZW50IG91ciBvd24gKGhhY2t5KSBzb2x1dGlvbiBieSB1c2luZyBNdXRhdGlvbk9ic2VydmVyXG4gICAgLy8gYW5kIGFkZGluZyBleHRyYSBjbGFzc2VzICh3aXRoIGN1c3RvbSBjc3MpIHRvIHRoZSBpbnB1dCBlbGVtZW50LlxuICAgIC8vIHdlIGFyZSBvYnNlcnZpbmcgdGhlIERPTSBmb3IgY2hhbmdlcyBiZWNhdXNlIGVuaGFuY2VTZWxlY3RFbGVtZW50KCkgdWx0aW1hdGVseVxuICAgIC8vIGNhbGxzIHJlbmRlciBpbiBQZWFjdCwgd2hpY2ggc2NoZWR1bGVzIGFuIHVwZGF0ZSB0byB0aGUgRE9NLCByYXRoZXIgdGhhbiBpbW1lZGlhdGVseSB1cGRhdGluZyB0aGUgRE9NLlxuICAgIC8vIChpZiB3ZSBmb3JrZWQgdGhlIGFjY2Vzc2libGUtYXV0b2NvbXBsZXRlIGNvbXBvbmVudCwgd2UgY291bGQgdXNlIGNvbXBvbmVudERpZE1vdW50IG9yIHVzZUVmZmVjdCBpbnN0ZWFkKS5cbiAgICAvLyB3ZSBhbHNvIG9ic2VydmUgYW55IGNoYW5nZXMgdG8gdGhlIGNsYXNzIGF0dHJpYnV0ZSBvZiB0aGUgdGV4dCBpbnB1dCBlbGVtZW50cyxcbiAgICAvLyBhcyBhbnkgY2hhbmdlcyB3ZSBtYWtlIHRvIHRoZSBpbnB1dCBlbGVtZW50J3MgY2xhc3MgYXR0cmlidXRlIHdpbGwgYmUgb3ZlcndyaXR0ZW4gYnkgdGhlIGNvbXBvbmVudCAob24gZm9jdXMgZXRjLikuXG5cbiAgICAvLyBJIHdhcyBnb2luZyB0byBlaXRoZXIgcGFja2FnZSB1cCB0aGlzIGNvZGUgaW50byBhbiBleHBvcnRlZCBmdW5jdGlvbiB0byBlYXNlIHJldXNlIGFuZCBtYWludGFuZW5jZSxcbiAgICAvLyBvciBmb3JrIHRoZSBhY2Nlc3NpYmxlLWF1dG9jb21wbGV0ZSBwcmVhY3QgY29tcG9uZW50LFxuICAgIC8vIGJ1dCBzb21lb25lIGlzIGFkZGluZyBvZmZpY2lhbCBzdXBwb3J0IHRvZGF5ICgyMDI0LTAxLTEyKSBzbyB3ZSBzaG91bGQgYmUgYWJsZSB0byByZW1vdmUgdGhpcyBzb29uIVxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHBoYWdvdi9hY2Nlc3NpYmxlLWF1dG9jb21wbGV0ZS9wdWxsLzYwMlxuXG4gICAgLy90b2RvOiBmaXggYXJpYS1kZXNjcmliZWRCeSBvbiB0aGUgaW5wdXQgdG9vXG4gICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHBoYWdvdi9hY2Nlc3NpYmxlLWF1dG9jb21wbGV0ZS9pc3N1ZXMvNTg5XG5cbiAgICBjb25zdCBkb21PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnNMaXN0LCBvYnNlcnZlcikgPT4ge1xuICAgICAgICBjb25zdCBjaGlsZExpc3RNdXRhdGlvbiA9IG11dGF0aW9uc0xpc3Quc29tZShtdXRhdGlvbiA9PiBtdXRhdGlvbi50eXBlID09PSAnY2hpbGRMaXN0JyAmJiBtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aCA+IDApO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzTXV0YXRpb24gPSBtdXRhdGlvbnNMaXN0LnNvbWUobXV0YXRpb24gPT4ge1xuICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IG11dGF0aW9uLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0RWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcgJiYgdGFyZ2V0RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSA9PT0gJ3RleHQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL2lmIChjaGlsZExpc3RNdXRhdGlvbikge1xuICAgICAgICAvLyAgICBjb25zb2xlLmxvZygnY2hpbGRMaXN0TXV0YXRpb24nKTtcbiAgICAgICAgLy99XG5cbiAgICAgICAgLy9pZiAoYXR0cmlidXRlc011dGF0aW9uKSB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKCdhdHRyaWJ1dGVzTXV0YXRpb24nKTtcbiAgICAgICAgLy99XG5cbiAgICAgICAgaWYgKGNoaWxkTGlzdE11dGF0aW9uIHx8IGF0dHJpYnV0ZXNNdXRhdGlvbikge1xuICAgICAgICAgICAgLyp0b2RvOiBjcmVhdGUgbGlzdCBvZiBpbnB1dCBpZHMgb3V0c2lkZSBvZiBvYnNlcnZlcj8gKi9cbiAgICAgICAgICAgIGxhbmd1YWdlU2VsZWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNlbGVjdC5pZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3QuaWQucmVwbGFjZSgnLXNlbGVjdCcsICcnKSkgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGlucHV0KTtcblxuICAgICAgICAgICAgICAgIC8vIGlucHV0IHNob3VsZCBuZXZlciBiZSBudWxsIG5vdyB3ZSdyZSBvYnNlcnZpbmcgdGhlIERPTSBmb3IgY2hhbmdlcywgYnV0IHdlIGNoZWNrIGl0IGZvciBleHRyYSBzYWZldHlcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ25vIGlucHV0IGZvdW5kIGZvciBzZWxlY3QnKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3JTdGF0ZSA9IHNlbGVjdC5jbGFzc0xpc3QuY29udGFpbnMoJ2dvdnVrLXNlbGVjdC0tZXJyb3InKTtcblxuICAgICAgICAgICAgICAgIGFkZEdvdlVrQ2xhc3NlcyhpbnB1dCwgZXJyb3JTdGF0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZG9tT2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSwgYXR0cmlidXRlczogdHJ1ZSB9KTtcblxuICAgIGxhbmd1YWdlU2VsZWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChzZWxlY3QpIHtcbiAgICAgICAgYWNjZXNzaWJsZUF1dG9jb21wbGV0ZS5lbmhhbmNlU2VsZWN0RWxlbWVudCh7XG4gICAgICAgICAgICBuYW1lOiAnbGFuZ3VhZ2VOYW1lJyxcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycsXG4gICAgICAgICAgICBzZWxlY3RFbGVtZW50OiBzZWxlY3RcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGFkZEdvdlVrQ2xhc3NlcyhpbnB1dDogSFRNTElucHV0RWxlbWVudCwgZXJyb3JTdGF0ZTogYm9vbGVhbikge1xuICAgIGlmICghaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdnb3Z1ay1pbnB1dCcpKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2dvdnVrLWlucHV0Jyk7XG4gICAgfVxuXG4gICAgaWYgKGVycm9yU3RhdGUgJiYgIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZ292dWstaW5wdXQtLWVycm9yJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnZ292dWstaW5wdXQtLWVycm9yJyk7XG4gICAgfVxufVxuXG4vL3RvZG86IHRoaXMgaXMgYSBoYWNrIC0gd2Ugd2FudCBzZXR1cExhbmd1YWdlQXV0b2NvbXBsZXRlV2hlbkFkZEFub3RoZXIgdG8gYmUgaW4gdGhlIGdlbmVyYXRlZCBqcyBmaWxlLlxuLy8gaWYgd2UgZXhwb3J0IGl0LCBpdCBpbmNsdWRlcyB0aGUgZXhwb3J0IGtleXdvcmQgaW4gdGhlIGdlbmVyYXRlZCBqcyBmaWxlXG4vLyAoYnV0IHdlIHVzZSBleHBvcnQgaW4gdGhlIG90aGVyIHRzIGZpbGVzLCB3aXRob3V0IHRoZSBqcyBjb250YWluaW5nIGV4cG9ydCEpXG4vLyBzbyBhcyBhIHdvcmthcm91bmQgd2UgY2FsbCBpdCB3aGVyZSBpdCBuby1vcHNcbnNldHVwTGFuZ3VhZ2VBdXRvY29tcGxldGVXaGVuQWRkQW5vdGhlcihudWxsKTtcbi8vfSk7Il19\n"]}